webpackJsonp([5],{632:function(t,i,e){function s(t){e(701)}var a=e(12)(e(678),e(743),s,null,null);t.exports=a.exports},645:function(t,i){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},646:function(t,i,e){"use strict";var s=e(648),a=e.n(s),n=e(35),r=e(66),c=e(231),u=e(647),o=e(232),l={lastLyric:0,typeType:localStorage.getItem("audioPlayType")||n.a.getters.getAudioPlayType,lyric:{},maxProgressWidth:0,dragProgressTo:0,x:0,l:0,parseLrc:function(t){if(!t)return"";for(var i=t.split("\n"),e={},s=0;s<i.length;s++){var a=decodeURIComponent(i[s]),n=/\[\d*:\d*((\.|\:)\d*)*\]/g,r=a.match(n);if(r)for(var c=a.replace(n,""),u=0,o=r.length;u<o;u++){var l=r[u],d=Number(String(l.match(/\[\d*/i)).slice(1)),m=Number(String(l.match(/\:\d*/i)).slice(1)),p=60*d+m;e[p]=c}}return e},getMusicSheet:function(t){var i="http://www.daiwei.org/vue/server/music.php?inAjax=1&do=playlist&id="+t;r.a.get(i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){n.a.dispatch({type:"set_MusicSheetList",data:t.data.playlist.tracks}),n.a.dispatch({type:"set_MusicList",data:t.data.playlist.tracks})},function(t){console.log(t)})},getAlbum:function(t){var i="http://www.daiwei.org/vue/server/music.php?inAjax=1&do=album&id="+t;r.a.get(i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){n.a.dispatch({type:"set_MusicSheetList",data:t.data.songs}),n.a.dispatch({type:"set_MusicList",data:t.data.songs})},function(t){console.log(t)})},getMusicLrc:function(t,i){var e=this,s=n.a.getters.getAudioEle,a="http://www.daiwei.org/vue/server/music.php?inAjax=1&do=lyric&id="+t.id;r.a.get(a).then(function(a){var r={};void 0===a.data.lrc?r={0:"纯音乐,请欣赏"}:(r=e.parseLrc(a.data.lrc.lyric),e.lyric=r),e.lastLyric=-1;var c={id:t.id,name:t.name,url:l.replaceUrl(t.url),singer:t.singer,duration:t.duration,picurl:t.picurl,index:t.musicndex,lyric:r,lrcContent:n.a.getters.getAudioLrcContent};n.a.commit({type:"setCurrentAudio",data:c}),"unupdate"!==t.type&&""===t.type&&n.a.dispatch({type:"set_MusicPlayList",data:t.list}),i.$nextTick(function(){try{n.a.getters.getAudioEle.load(),n.a.getters.getAudioEle.play()}catch(t){return}n.a.commit({type:"setAudiolrcIndex",data:0}),e.scrollAnimate(document.getElementsByClassName("lrc-wrapper")[0],0),n.a.commit("setAudioIsPlay",!s.paused)})},function(t){console.log(t)})},getMusicDurantionType:function(t){return(Math.floor(t/1e3/60)>=10?Math.floor(t/1e3/60):"0"+Math.floor(t/1e3/60))+":"+(Math.floor(t/1e3%60)>=10?Math.floor(t/1e3%60):"0"+Math.floor(t/1e3%60))},scrollLyric:function(t,i){if(""===this.lyric)return!1;if(t=parseInt(t),void 0===this.lyric||void 0===this.lyric[t])return!1;if(this.lastLyric===t)return!0;var e=0;n.a.commit({type:"setAudiolrcIndex",data:e});for(var s in this.lyric){if(s>t)break;e++}this.lastLyric=t,n.a.commit({type:"setAudiolrcIndex",data:e});try{this.scrollAnimate(i.$refs.lrcWrapper,e*document.getElementsByClassName("lrc-item")[0].offsetHeight)}catch(t){return}},clickIndex:function(t,i){var e=this,s=t.music_id?t.music_id:t.id,a="http://www.daiwei.org/vue/server/music.php?inAjax=1&do=musicInfo&id="+s;r.a.get(a).then(function(a){if(null===a.data.data[0].url){i.$msg("音乐无法播放,请播放其他音频...");var r={index:n.a.getters.getCurrentAudio.index};return n.a.commit({type:"setCurrentAudio",data:r}),void e.playNextPrev(i,!0)}var c={id:s,name:t.name,url:l.replaceUrl(a.data.data[0].url),singer:t.singer,duration:t.duration,picurl:t.pic,musicndex:t.index,list:t.list,type:t.type};e.getMusicLrc(c,i)},function(t){console.log(t)})},searchMusic:function(t,i,e){var s="http://www.daiwei.org/vue/server/music.php?inAjax=1&do=search&count=30&pages="+i+"&name="+t;r.a.get(s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){try{console.log(e.searchMusicList),t.data.result.songs.forEach(function(t,i,s){e.searchMusicList.push(t)}),n.a.dispatch({type:"set_MusicSearchList",data:e.searchMusicList}),n.a.dispatch({type:"set_MusicList",data:e.searchMusicList})}catch(t){return}},function(t){console.log(t)})},scrollAnimate:function(t,i){t.style.WebkitTransform="translate3d(-50%, -"+i+"px, 0)",t.style.transform="transform: translate3d(-50%, -"+i+"px, 0)"},collectMusic:function(t){var i=this;e.i(u.a)().then(function(s){var a={userid:s.id,music_id:t.id,music_name:t.name,singer_id:t.ar[0].id,singer_name:t.ar[0].name,album_id:t.al.id,album_name:t.al.name,music_dur:t.dt,music_picurl:t.al.picUrl};e.i(u.b)("http://www.daiwei.org/vue/server/user.php?inAjax=1&do=collectMusic",a).then(function(t){i.$msg(t.data.msg)},function(t){i.$msg(t)})},function(t){i.$msg(t.msg),i.$router.push({path:"/user/login"})})},getLocalMusic:function(){var t=this;e.i(u.a)().then(function(i){e.i(u.b)("http://www.daiwei.org/vue/server/user.php?inAjax=1&do=getCollectMusic",{userid:i.id}).then(function(t){n.a.commit({type:"setMusicCollectList",data:t.data})},function(i){t.$msg(i)})},function(i){t.$msg(i.msg),t.$router.push({path:"/user/login"})})},deleteMusic:function(t){var i=this;e.i(u.a)().then(function(s){e.i(u.b)("http://www.daiwei.org/vue/server/user.php?inAjax=1&do=delCollectMusic",{userid:s.id,music_id:t}).then(function(e){var s=n.a.getters.getMusicCollectList;s.forEach(function(i,e,a){if(t===i.music_id)return void s.splice(e,1)}),n.a.commit({type:"setMusicCollectList",data:s}),i.$msg(e.data.msg)},function(t){i.$msg(t)})},function(t){i.$msg(t.msg),i.$router.push({path:"/user/login"})})},playPause:function(){try{var t=n.a.getters.getAudioEle;if(!(t.src.indexOf(".mp3")>0))return;t.paused?t.play():t.pause(),n.a.commit("setAudioIsPlay",!t.paused)}catch(t){return}},playNextPrev:function(t,i){var e=this,s=n.a.getters.getCurrentAudio.index||0,a=n.a.getters.getMusicPlayList.length||0,c=n.a.getters.getMusicPlayList||[];if(3!==this.typeType?i?++s>a-1&&(s=0):--s<0&&(s=a-1):s=Math.floor(Math.random()*a),void 0!==c[s]){var u=c[s].music_id?c[s].music_id:c[s].id,o="http://www.daiwei.org/vue/server/music.php?inAjax=1&do=musicInfo&id="+u;r.a.get(o).then(function(a){if(null===a.data.data[0].url){var r={index:n.a.getters.getCurrentAudio.index?i?n.a.getters.getCurrentAudio.index+1:n.a.getters.getCurrentAudio.index-1:i?1:0};return n.a.commit({type:"setCurrentAudio",data:r}),void e.playNextPrev(t,i)}var o={id:u,name:c[s].name?c[s].name:c[s].music_name,url:l.replaceUrl(a.data.data[0].url),singer:c[s].ar?c[s].ar[0].name:c[s].singer_name,duration:l.getMusicDurantionType(c[s].dt?c[s].dt:c[s].music_dur),picurl:c[s].al?c[s].al.picUrl:c[s].music_picurl,musicndex:s,list:n.a.getters.getMusicList,type:"unupdate"};e.getMusicLrc(o,t)},function(t){console.log(t)})}},initAudioEvent:function(t){var i=this,e=n.a.getters.getAudioEle;e.onloadedmetadata=function(){},e.onended=function(){i.insetMusicListen(),i.playNextPrev(t,!0)},e.ontimeupdate=function(){if(!t.isDrag){var i=n.a.getters.getAudioEle,e=Math.floor(i.duration),s=Math.floor(i.currentTime);l.scrollLyric(s,t),n.a.dispatch("set_AudioCurrentTime",s),n.a.dispatch("set_AudioCurrentD",s/e*100)}},e.onprogress=function(){var i=Math.floor(e.duration);try{if(e.buffered.length>0){for(var s=0,a=0;a<e.buffered.length;a++)(s+=e.buffered.end(a)-e.buffered.start(a))>i&&(s=i,console.log("缓冲完成"));var n=Math.floor(s/i*100);t.bufferingP=n}}catch(t){return}}},dragMouseDown:function(t,i){var e=n.a.getters.getAudioEle;if(!(e.src.indexOf(".")<0)){var s=this;t.isDrag=!0;var a=i||window.event,r=a.clientX,c=a.target.offsetLeft;s.maxProgressWidth=document.getElementById("music_progressD").offsetWidth;var u=document.getElementById("music_progress");u.onmousemove=function(i){if(t.isDrag){var e=i||window.event,a=e.clientX;s.dragProgressTo=Math.min(s.maxProgressWidth,Math.max(0,c+(a-r))),s.updateDragProgress(t,s.maxProgressWidth,s.dragProgressTo)}},u.onmouseup=function(i){var a=e.duration;t.isDrag&&(t.isDrag=!1,e.currentTime=Math.floor(s.dragProgressTo/s.maxProgressWidth*a))},u.onmouseleave=function(i){var a=e.duration;t.isDrag&&(t.isDrag=!1,e.currentTime=Math.floor(s.dragProgressTo/s.maxProgressWidth*a))}}},dragTouchStart:function(t,i){if(!(n.a.getters.getAudioEle.src.indexOf(".")<0)){var e=this;t.isDrag=!0;var s=i||window.event;e.x=s.touches[0].clientX,e.l=s.target.offsetLeft,e.maxProgressWidth=document.getElementById("music_progressD").offsetWidth}},dragTouchMove:function(t,i){var e=this;if(t.isDrag){var s=i||window.event,a=s.touches[0].clientX;e.dragProgressTo=Math.min(e.maxProgressWidth,Math.max(0,e.l+(a-e.x))),e.updateDragProgress(t,e.maxProgressWidth,e.dragProgressTo)}},dragTouchEnd:function(t,i){var e=this,s=n.a.getters.getAudioEle,a=s.duration;t.isDrag&&(t.isDrag=!1,s.currentTime=Math.floor(e.dragProgressTo/e.maxProgressWidth*a))},updateDragProgress:function(t,i,e){var s=n.a.getters.getAudioEle,a=s.duration;l.scrollLyric(Math.floor(e/i*a),t),n.a.dispatch("set_AudioCurrentTime",Math.floor(e/i*a)),n.a.dispatch("set_AudioCurrentD",Math.floor(e/i*a)/a*100)},clickProgress:function(t){var i=n.a.getters.getAudioEle,e=i.duration,s=t||window.event,a=s.offsetX,r=document.getElementById("music_progressD").offsetWidth;i.currentTime=Math.floor(a/r*e)},replaceUrl:function(t){return t.indexOf("//m7c")<0?t.indexOf("//m8c")?t.replace("//m8c","//m8"):t:t.replace("//m7c","//m7")},insetMusicListen:function(){e.i(u.a)().then(function(t){var i=n.a.getters.getCurrentAudio.index,s=n.a.getters.getMusicPlayList,a={userid:t.id,username:t.username,music_id:s[i].music_id||s[i].id,music_name:s[i].music_name||s[i].name,singer_id:s[i].singer_id||s[i].ar[0].id,singer_name:s[i].singer_name||s[i].ar[0].name,album_id:s[i].album_id||s[i].al.id,album_name:s[i].album_name||s[i].al.name,music_dur:s[i].music_dur||s[i].dt,music_picurl:s[i].music_picurl||s[i].al.picUrl,listen_time:c.a.formatDate(new Date,"yyyy-MM-dd hh:mm:ss")};e.i(u.b)("http://www.daiwei.org/vue/server/user.php?inAjax=1&do=userMusicListen",a).then(function(t){console.log(a.music_name+"播放完成")},function(t){o.default.$msg(t)})},function(t){o.default.$msg(t.msg)})},setPlayType:function(t){this.typeType=a()(t),n.a.dispatch({type:"set_AudioPlayType",data:this.typeType}),localStorage.setItem("audioPlayType",this.typeType)}};i.a=l},647:function(t,i,e){"use strict";function s(t,i){return new r.a(function(e,s){c.a.post(t,i).then(function(t){e(t)},function(t){s(t)})})}function a(){var t=u.a.getters.getUserInfo;return new r.a(function(i,e){null===t?(o.a.push("/user/login"),e(l)):i(t)})}i.b=s,i.a=a;var n=e(101),r=e.n(n),c=e(66),u=e(35),o=e(150),l={code:0,msg:"用户未登录"}},648:function(t,i,e){t.exports={default:e(649),__esModule:!0}},649:function(t,i,e){e(652),t.exports=parseInt},650:function(t,i,e){var s=e(15).parseInt,a=e(651).trim,n=e(645),r=/^[-+]?0[xX]/;t.exports=8!==s(n+"08")||22!==s(n+"0x16")?function(t,i){var e=a(String(t),3);return s(e,i>>>0||(r.test(e)?16:10))}:s},651:function(t,i,e){var s=e(60),a=e(102),n=e(67),r=e(645),c="["+r+"]",u="​",o=RegExp("^"+c+c+"*"),l=RegExp(c+c+"*$"),d=function(t,i,e){var a={},c=n(function(){return!!r[t]()||u[t]()!=u}),o=a[t]=c?i(m):r[t];e&&(a[e]=o),s(s.P+s.F*c,"String",a)},m=d.trim=function(t,i){return t=String(a(t)),1&i&&(t=t.replace(o,"")),2&i&&(t=t.replace(l,"")),t};t.exports=d},652:function(t,i,e){var s=e(60),a=e(650);s(s.S+s.F*(Number.parseInt!=a),"Number",{parseInt:a})},653:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e(35),a=e(646),n=e(151),r=e.n(n),c=e(233);i.default={data:function(){return{currentMusic:{},params:this.$route.params,currentMusicLrcIndex:0,searchMusicIndex:1,searchMusicList:[]}},methods:{searchMusic:function(t){this.$router.push({name:"searchlist",params:{w:t.target.innerHTML}}),this.searchMusicIndex=1,this.searchMusicList=[],a.a.searchMusic(t.target.innerHTML,this.searchMusicIndex,this)},searchMoreMusic:function(t){var i=t.target,e=i.scrollTop+i.offsetHeight;i.scrollHeight===e&&(this.searchMusicIndex++,a.a.searchMusic(this.params.w,this.searchMusicIndex,this))},pullingUp:function(t){this.searchMusicIndex++,a.a.searchMusic(this.params.w,this.searchMusicIndex,this)},getAlbum:function(t){this.$router.push({name:"albumlist",params:{id:t}})},getMusicDurationType:function(t){return a.a.getMusicDurantionType(t,this)},clickPlayList:function(t,i,e,s,n,r,c){var u={id:t,name:i,pic:e,singer:s,duration:n,index:r,list:this.musiclist,type:this.musictype};a.a.clickIndex(u,this)},showIcon:function(t){e.i(c.a)(t.target,"visible")},hideIcon:function(t){e.i(c.b)(t.target,"visible")},deleteMusic:function(t){a.a.deleteMusic.call(this,t)},initMusic:function(){this.$emit("init")},collectMusic:function(t){var i=s.a.getters.getMusicList[t];a.a.collectMusic.call(this,i)}},components:{scroll:r.a},props:{musiclist:{stype:Array,default:[]},showdelicon:{stype:Boolean,default:!1},musictype:{type:String,default:""}},computed:{getCurrentMusic:function(){return s.a.getters.getCurrentAudio},isNeedPull:function(){return this.$route.path.includes("/music/searchlist")}},watch:{$route:function(t,i){this.params=this.$route.params}}}},654:function(t,i){},655:function(t,i,e){function s(t){e(654)}var a=e(12)(e(653),e(656),s,null,null);t.exports=a.exports},656:function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"musiclist music_list_container"},[e("scroll",{staticClass:"music_l_content",attrs:{data:t.musiclist,needPullUp:t.isNeedPull},on:{pullingUp:t.pullingUp}},[e("div",{staticClass:"content"},[t.musiclist.length?t._e():e("span",{staticClass:"list_empty"},[t._v("暂无音乐列表哦 !")]),t._v(" "),t._l(t.musiclist,function(i,s){return t.musiclist&&t.musiclist[0].music_id?e("div",{key:i.music_id,staticClass:"music_list border-1px",attrs:{"data-musicid":i.music_id,"data-pic":i.music_picurl},on:{mouseenter:t.showIcon,mouseleave:t.hideIcon,click:function(e){t.clickPlayList(i.music_id,i.music_name,i.music_picurl,i.singer_name,t.getMusicDurationType(i.music_dur),s),t.musiclist}}},[e("span",{staticClass:"music_index"},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.getCurrentMusic.id!==i.music_id,expression:"getCurrentMusic.id !== list.music_id"}]},[t._v(t._s(s+1))]),t._v(" "),e("img",{directives:[{name:"show",rawName:"v-show",value:t.getCurrentMusic.id===i.music_id,expression:"getCurrentMusic.id === list.music_id"}],attrs:{src:"http://www.daiwei.org/vue/bg/wave.gif",alt:"未曾遗忘的青春"}})]),t._v(" "),e("div",{staticClass:"music_name"},[e("span",{staticClass:"span_name"},[t._v(t._s(i.music_name))]),t._v(" "),e("div",{staticClass:"hover_menu"},[t.showdelicon?e("i",{staticClass:"icon-delete",on:{click:function(e){e.stopPropagation(),t.deleteMusic(i.music_id)}}}):t._e(),t._v(" "),t.showdelicon?t._e():e("i",{staticClass:"icon-add",on:{click:function(i){i.stopPropagation(),t.collectMusic(s)}}})])]),t._v(" "),i.singer_name?e("span",{staticClass:"music_singer"},[e("span",{on:{click:function(i){i.stopPropagation(),t.searchMusic(i)}}},[t._v(t._s(i.singer_name))])]):t._e(),t._v(" "),i.album_name?e("span",{staticClass:"music_zhuanji"},[e("span",{on:{click:function(e){e.stopPropagation(),t.getAlbum(i.album_id)}}},[t._v(t._s(i.album_name))])]):t._e(),t._v(" "),e("span",{staticClass:"music_duration"},[t._v(t._s(t.getMusicDurationType(i.music_dur)))])]):t._e()}),t._v(" "),t._l(t.musiclist,function(i,s){return t.musiclist&&t.musiclist[0].al?e("div",{key:i.id,staticClass:"music_list border-1px",attrs:{"data-musicid":i.id,"data-pic":i.al.picUrl},on:{mouseenter:t.showIcon,mouseleave:t.hideIcon,click:function(e){t.clickPlayList(i.id,i.name,i.al.picUrl,i.ar[0].name,t.getMusicDurationType(i.dt),s),t.musiclist}}},[e("span",{staticClass:"music_index"},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.getCurrentMusic.id!==i.id,expression:"getCurrentMusic.id !== list.id"}]},[t._v(t._s(s+1))]),t._v(" "),e("img",{directives:[{name:"show",rawName:"v-show",value:t.getCurrentMusic.id===i.id,expression:"getCurrentMusic.id === list.id"}],attrs:{src:"http://www.daiwei.org/vue/bg/wave.gif",alt:"未曾遗忘的青春"}})]),t._v(" "),e("div",{staticClass:"music_name"},[e("span",{staticClass:"span_name"},[t._v(t._s(i.name))]),t._v(" "),e("div",{staticClass:"hover_menu"},[t.showdelicon?e("i",{staticClass:"icon-delete",on:{click:function(e){e.stopPropagation(),t.deleteMusic(i.music_id)}}}):t._e(),t._v(" "),t.showdelicon?t._e():e("i",{staticClass:"icon-add",on:{click:function(i){i.stopPropagation(),t.collectMusic(s)}}})])]),t._v(" "),i.ar?e("span",{staticClass:"music_singer"},[e("span",{on:{click:function(i){i.stopPropagation(),t.searchMusic(i)}}},[t._v(t._s(i.ar[0].name))])]):t._e(),t._v(" "),i.al?e("span",{staticClass:"music_zhuanji"},[e("span",{on:{click:function(e){e.stopPropagation(),t.getAlbum(i.al.id)}}},[t._v(t._s(i.al.name))])]):t._e(),t._v(" "),e("span",{staticClass:"music_duration"},[t._v(t._s(t.getMusicDurationType(i.dt)))])]):t._e()})],2)])],1)},staticRenderFns:[]}},678:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e(35),a=e(646),n=e(655),r=e.n(n);i.default={data:function(){return{currentMusic:{},params:this.$route.params,currentMusicLrcIndex:0}},props:{lrccontent:{}},methods:{searchMusic:function(t){this.$router.push({name:"searchlist",params:{w:t.target.innerHTML}})},getAlbum:function(t){this.$router.push({name:"albumlist",params:{id:t}})},getMusicDurationType:function(t){return a.a.getMusicDurantionType(t,this)},clickPlayList:function(t,i,e,n,r,c,u){var o={id:t,name:i,pic:e,singer:n,duration:r,index:c,list:s.a.getters.getMusicCollectList};a.a.clickIndex(o,this)},deleteMusic:function(t){a.a.deleteMusic.call(this,t)},initMusic:function(){a.a.getLocalMusic.call(this)}},computed:{musicList:function(){return s.a.getters.getMusicCollectList},getCurrentMusic:function(){return s.a.getters.getCurrentAudio}},watch:{$route:function(t,i){this.params=this.$route.params}},components:{musiclist:r.a},mounted:function(){var t=this;this.$nextTick(function(){t.initMusic()})}}},701:function(t,i){},743:function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"music_collection"},[e("div",{staticClass:"list_content_info"},[t._m(0),t._v(" "),t.musicList?e("musiclist",{attrs:{musiclist:t.musicList,showdelicon:"false"},on:{init:t.initMusic}}):t._e()],1)])},staticRenderFns:[function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"music_list_title border-1px"},[e("span",{staticClass:"music_index"}),t._v(" "),e("span",{staticClass:"music_name"},[t._v("歌曲")]),t._v(" "),e("span",{staticClass:"music_singer"},[t._v("歌手")]),t._v(" "),e("span",{staticClass:"music_zhuanji"},[t._v("专辑")]),t._v(" "),e("span",{staticClass:"music_duration"},[t._v("时长")])])}]}}});